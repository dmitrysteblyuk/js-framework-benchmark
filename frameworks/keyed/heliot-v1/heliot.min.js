var f=Symbol("scope"),h=Symbol("effect"),c=Symbol("observers");function E(n){var e,t;return t=class{constructor(r){this[e]=new Set;this.#e=r}#e;get $(){return n(this),this.#e}set $(r){this.#e=r;for(let s of this[c])s.notify()}},e=c,t}function I(n,e,t,r,s){var l,a;return a=class{constructor(o,i){this.#t=!1;this.#n=!1;this.#r=new s(this);this.#s=[];this.#i=r();this[l]=new Set;e(this),this.#o=o;for(let p=0;p<i.length;p++)t(p,i[p],this);this.execute(),this.#n=!0}#e;#t;#n;#r;#o;#s;#i;get $(){return n(this),this.#e}next(o,i){if(this.#s.length===o){this.#s.push(i);return}this.#s[o]!==i&&(this.#s[o]=i,this.#i.addToQueue(this))}call(){let o=this.#o(...this.#s);this.#n&&this.#e===o||(this.#t=!0,this.#e=o)}execute(){if(this.#r.next(),!!this.#t){this.#t=!1;for(let o of this[c])o.notify()}}dispose(){try{this.#i.removeFromQueue(this)}finally{this.#r=this.#s=this.#o=this.#i=this.#e=this[c]=null}}},l=c,a}function A(n,e){let t=null,r=o=>{t?.push(o)};class s{constructor(i,p,d){this.#r=e();n(this),p[c].add(this),this.#e=p,this.#t=d,this.#n=i,this.execute()}#e;#t;#n;#r;execute(){this.#t.next(this.#n,this.#e.$)}dispose(){try{this.#r.removeFromQueue(this),this.#e[c]?.delete(this)}finally{this.#e=this.#t=this.#r=null}}notify(){this.#r.addToQueue(this)}}class l{constructor(i,p,d){this.#r=e();this.#o=[];n(this),this.#n=i,this.#e=p,this.#t=d;let u,w=t;t=this.#o;try{u=this.#e()}finally{t=w;for(let B of this.#o)B[c].add(this)}d.next(i,u)}#e;#t;#n;#r;#o;execute(){this.#t.next(this.#n,this.#e())}dispose(){try{if(this.#r.removeFromQueue(this),this.#o)for(let i of this.#o)i[c]?.delete(this)}finally{this.#n=this.#e=this.#t=this.#o=this.#r=null}}notify(){this.#r.addToQueue(this)}}return[(o,i,p)=>{typeof i=="function"?new l(o,i,p):new s(o,i,p)},r]}function K(n,e){let t=e;class r{constructor(){this.#e=t}#e;dispose(){t=this.#e}}return[a=>{n(new r),t=a},()=>t]}function $(){let n=null,e=s=>{if(n===null)throw new Error("Cannot use reactive statements out of scope.");n.push(s)},t=class{constructor(s,l){this.#e=[];let a=n;try{n=this.#e,typeof s=="function"?s(...l):s.call(...l)}catch(o){throw this.dispose(),o}finally{n=a}}#e;dispose(){try{for(let s of this.#e)s.dispose()}finally{this.#e=null}}},r=class{constructor(s){this.#e=null;e(this),this.#t=s}#e;#t;next(...s){this.#e?.dispose(),this.#e=new t(this.#t,s)}dispose(){try{this.#e?.dispose()}finally{this.#e=null}}};return[e,t,r]}function y(n){let[e,t,r]=$(),[s,l]=K(e,n),[a,o]=A(e,l),i=E(o),p=I(o,e,a,l,r),d=(...u)=>u.length<2?new i(u[0]):new p(u.pop(),u);return d[h]=a,d[f]=r,d.newScope=(u,w)=>new t(u,w),d.useScheduler=s,d.onDispose=e,d}var v=class{constructor(){this.#e=new Set;this.#t=!1;this.#n=()=>{for(let e of this.#e)e.execute();this.#e.clear(),this.#t=!1}}#e;#t;#n;addToQueue(e){this.#e.add(e),!this.#t&&(this.#t=!0,queueMicrotask(this.#n))}removeFromQueue(e){this.#e.delete(e)}};var L=class{constructor(){this.#e=new Set;this.#t=0;this.#n=()=>{for(let e of this.#e)e.execute();this.#e.clear(),this.#t=0}}#e;#t;#n;addToQueue(e){this.#e.add(e),!this.#t&&(this.#t=requestAnimationFrame(this.#n))}removeFromQueue(e){!this.#e.delete(e)||this.#e.size>0||(cancelAnimationFrame(this.#t),this.#t=0)}};var N=class{addToQueue(e){e.execute()}removeFromQueue(){}};function C(n){return typeof n=="function"||S(n)}function S(n){return typeof n=="object"&&n!==null&&c in n}function T(n){return S(n)&&!n.next}var P=y(new v);var b=class{#e;#t;constructor(e,t){e.$.onDispose(this),this.#e=e,this.#t=t}getLastNode(){return this.#t}dispose(){try{let{parent:e}=this.#e;e.parentElement!==null&&e.removeChild(this.#t)}finally{this.#t=this.#e=null}}render(e){let{previous:t,parent:r}=this.#e,s=t?.getLastNode()??null;if(e&&s===this.#t.previousSibling)return;let l=s===null?r.firstChild:s.nextSibling;l===null?r.appendChild(this.#t):r.insertBefore(this.#t,l)}};function V(n,e){let t=new b(n,n.parent.ownerDocument.createTextNode(typeof e=="string"?e:e+""));return t.render(!1),t}var g=class{#e;#t;constructor(e,t){this.#e=e.previous,e.$[h](e,t,new e.$[f](this))}call(e,t){this.#t=m(e,t)}getLastNode(){return this.#t?this.#t.getLastNode():this.#e&&this.#e.getLastNode()}render(){this.#t?.render(!0)}};function m(n,e){return typeof e=="string"||typeof e=="number"?V(n,e):C(e)?new g(n,e):e?.mount(n)}var x=class{constructor(e){this.element=e}},j=class extends x{next(e,t){this.element.style[e]=t}},F=class extends x{next(e,t){t?this.element.classList.add(e):this.element.classList.remove(e)}},k=class extends x{next(e,t){t===null?this.element.removeAttribute(e):this.element.setAttribute(e,t)}},q={next:(n,e)=>{n.value=e}};function G(n,e,t,r,s){switch(t){case"styles":let l=new j(e);for(let o in r)R(n,o,r[o],l);return;case"classes":let a=new F(e);for(let o in r)R(n,o,r[o],a);return;case"value":R(n,e,r,q),T(r)&&(e.oninput=()=>{let{type:o,value:i}=e;r.$=o==="number"?+i:i});return}if(/^on[A-Z]/.test(t)){e[t.toLowerCase()]=r;return}R(n,t,r,s)}function R(n,e,t,r){C(t)?n[h](e,t,r):r.next(e,t)}var O=class{#e;#t;#n;constructor(e,t,r){this.#e=e,this.#t=t,this.#n=r}mount(e){let t=e.parent.ownerDocument.createElement(this.#e),r=new b(e,t),s={...e,previous:null,parent:t};for(let o of this.#n){let i=m(s,o);i&&(s={...s,previous:i})}let l=new k(t),a=this.#t;for(let o in a)G(e.$,t,o,a[o],l);return r.render(!1),r}};var D=class{#e;#t;#n;constructor(e,t,r){this.#e=e,this.#t=t,this.#n=r}mount(e){return this.#e(this.#t,this.#n).mount(e)}};function z(n){return n.prototype?.mount}var J=(n,e,...t)=>typeof n=="string"?new O(n,e,t):z(n)?new n(e,t):new D(n,e??{},t);var X=(n,e)=>e,M=class{#e;constructor({each:e,key:t=X},[r]){this.#e={each:e,key:t,child:r}}mount(e){return new Q(e,this.#e)}},H=class{constructor(e,t,r){this.item=t;this.index=r;this.#e=e}#e;getLastNode(){return this.#e.getNodeBeforeIndex(this.index.$)}call(e,t){this.renderer=m({...e,previous:this},this.#e.props.child(this.item,this.index,t))}},Q=class{constructor(e,t){this.props=t;this.#t=new Map;this.#n=[];this.#e=e.previous,e.$.onDispose(this),e.$[h](e,t.each,new e.$[f](this))}#e;#t;#n;dispose(){this.props=this.#e=this.#t=this.#n=null}call(e,t){let r=new Map,{$:s}=e,l=0;for(let a of t){let o=this.props.key(a,l),i=this.#t.get(o);i?((i.moved=i.index.$!==l)&&(i.index.$=l),i.item.$!==a&&(i.item.$=a)):i=new H(this,s(a),s(l)),r.set(o,i),l++}for(let[a,o]of this.#t)r.has(a)||o.scope.dispose();this.#t=r,this.#n=Array.from(r.values());for(let[a,o]of r)o.scope?o.moved&&o.renderer?.render(!0):o.scope=s.newScope(o,[e,a])}render(){for(let{renderer:e}of this.#n)e?.render(!0)}getLastNode(){return this.getNodeBeforeIndex(this.#n.length)}getNodeBeforeIndex(e){for(let t=e;t-- >0;){let{renderer:r}=this.#n[t];if(r)return r.getLastNode()}return this.#e&&this.#e.getLastNode()}};var W=class{#e;constructor(e,t){this.#e=t}mount(e){return new U(e,this.#e)}},U=class{constructor(e,t){this.#t=[];this.#e=e.previous;let r=e;e.$.onDispose(this);for(let s of t){let l=m(r,s);l&&(this.#t.push(l),r={...r,previous:l})}}#e;#t;dispose(){this.#t=this.#e=null}render(){for(let e of this.#t)e.render(!0)}getLastNode(){return this.#t.length===0?this.#e&&this.#e.getLastNode():this.#t[0].getLastNode()}};var _=(n,e)=>{n.mount(e)};function Z(n,e,{$:t=P,afterNode:r=null}={}){return t.newScope(_,[n,{$:t,parent:e,previous:r&&{getLastNode:()=>r}}])}export{P as $,L as AnimationFrameScheduler,M as For,W as Fragment,N as ImmediateScheduler,v as MicroTaskScheduler,y as createReactiveAPI,J as h,S as isObservable,C as isReactive,T as isSubject,Z as render};
